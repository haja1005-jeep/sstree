<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>신안군 스마트 트리맵 현장 입력</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=257fdd3647dd6abdb05eae8681106514&libraries=services"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    
    <!-- API Configuration (먼저 로드) -->
    <script src="config.js"></script>

    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="sidemenu_addon.css">
	
</head>
<body>
   
	 <!-- 사이드 메뉴 오버레이 -->
    <div class="side-menu-overlay" id="sideMenuOverlay" onclick="closeSideMenu()"></div>


    <!-- ⭐ 사이드 메뉴 -->
    <div class="side-menu" id="sideMenu">
        <div class="side-menu-header">
            <div class="side-menu-profile">
                <div class="profile-avatar">🌳</div>
                <div class="profile-info">
                    <div class="profile-name" id="sideMenuUserName">스마트 트리맵</div>
                    <div class="profile-email" id="sideMenuUserEmail">로그인이 필요합니다</div>
                </div>
            </div>
            <button class="side-menu-close" onclick="closeSideMenu()">✕</button>
        </div>
        
        <div class="side-menu-content">
            <!-- 내 작업 섹션 -->
            <div class="menu-section">
                <div class="menu-section-title">📁 내 작업</div>
                <a href="#" class="menu-item" onclick="handleMenuClick('new')">
                    <span class="menu-icon">✏️</span>
                    <span class="menu-text">새 작업 시작</span>
                </a>
                <a href="#" class="menu-item" onclick="handleMenuClick('recent')">
                    <span class="menu-icon">🕐</span>
                    <span class="menu-text">최근 작업</span>
                </a>
                <a href="#" class="menu-item" onclick="handleMenuClick('drafts')">
                    <span class="menu-icon">📝</span>
                    <span class="menu-text">임시 저장</span>
                </a>
            </div>
            
            <!-- Google Drive 섹션 -->
            <div class="menu-section">
                <div class="menu-section-title">☁️ Google Drive</div>
                <a href="#" class="menu-item" onclick="handleMenuClick('load')">
                    <span class="menu-icon">📂</span>
                    <span class="menu-text">폴더에서 불러오기</span>
                </a>
                <a href="#" class="menu-item" onclick="handleMenuClick('merge')">
                    <span class="menu-icon">📊</span>
                    <span class="menu-text">스프레드시트 통합</span>
                </a>
                <a href="#" class="menu-item" onclick="handleMenuClick('browse')">
                    <span class="menu-icon">🔍</span>
                    <span class="menu-text">내 드라이브 보기</span>
                </a>
            </div>
            
            <!-- 설정 섹션 -->
            <div class="menu-section">
                <div class="menu-section-title">⚙️ 설정</div>
                <a href="#" class="menu-item" onclick="handleMenuClick('profile')">
                    <span class="menu-icon">👤</span>
                    <span class="menu-text">프로필</span>
                </a>
                <a href="#" class="menu-item" onclick="handleMenuClick('settings')">
                    <span class="menu-icon">🔧</span>
                    <span class="menu-text">환경 설정</span>
                </a>
                <a href="#" class="menu-item" onclick="handleMenuClick('help')">
                    <span class="menu-icon">❓</span>
                    <span class="menu-text">도움말</span>
                </a>
            </div>
        </div>
        
        <!-- 사이드 메뉴 푸터 -->
        <div class="side-menu-footer">
            <button class="menu-logout-btn" onclick="handleMenuLogout()" id="menuLogoutBtn" style="display: none;">
                🚪 로그아웃
            </button>
            <div class="menu-version">v1.0.0</div>
        </div>
    </div>
	
    <!-- End 사이드 메뉴 -->	
	
	
	
	<div class="container">

   

       <div class="top-header">
          <button class="hamburger-menu" onclick="openSideMenu()">
           <span></span>
           <span></span>
		   <span></span>
          </button>
          <h1 class="app-title">🌳 신안군 스마트 트리맵</h1>
        </div>

        <div class="main-header">
            <div class="header-content">

                
                <div class="filter-section">
                    <div class="filter-group">
                        <label class="filter-label" for="region-select">1. 지역</label>
                        <select id="region-select" onchange="onRegionChange()">
                            <option value="">전체</option>
                            <option value="비금면">비금면</option>
                            <option value="도초면">도초면</option>
                            <option value="지도읍">지도읍</option>
                            <option value="압해읍">압해읍</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">2. 카테고리</label>
                        <select id="category-select" onchange="onCategoryChange()" disabled>
                            <option value="">전체</option>
                            <option value="공원">공원</option>
                            <option value="생활숲">생활숲</option>
                            <option value="가로수">가로수</option>
                        </select>
                    </div>   

                    <div class="filter-group">
                        <label class="filter-label" for="place-select">3. 장소</label>
                        <select id="place-select" onchange="onPlaceChange()" disabled>
                            <option value="">전체</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label" for="tree-select">4. 나무종류</label>
                        <select id="tree-select" disabled>
                            <option value="">전체</option>
                        </select>
                    </div>


<!-- 🌳 나무 상세 정보 섹션 (수종 선택 시 표시됨) 1105 - 01   -->
<div class="tree-details-section" id="treeDetailsSection" style="display: none;">
    
    <!-- 높이 입력 -->
    <div class="input-group">
        <label for="treeHeight">
            <span class="label-icon">📏</span>
            <span class="label-text">나무 높이</span>
        </label>
        <div class="input-with-unit">
            <input type="number" id="treeHeight" placeholder="예: 5.5" step="0.1" min="0" max="100" inputmode="decimal"  pattern="[0-9]*\.?[0-9]*">
            <span class="unit">m</span>
        </div>
    </div>

    <!-- 두께(둘레) 입력 -->
    <div class="input-group">
        <label for="treeThickness">
            <span class="label-icon">⭕</span>
            <span class="label-text">나무 둘레(두께)</span>
        </label>
        <div class="input-with-unit">
            <input type="number" id="treeThickness" placeholder="예: 120" step="1" min="0"  max="1000"  inputmode="decimal" pattern="[0-9]*">
            <span class="unit">cm</span>
        </div>
    </div>

    <!-- 상태 선택 -->
    <div class="input-group">
        <label for="treeStatus">
            <span class="label-icon">🔍</span>
            <span class="label-text">나무 상태</span>
        </label>
        <select id="treeStatus">
            <option value="">상태를 선택하세요</option>
            <option value="양호">✅ 양호</option>
            <option value="보통">⚠️ 보통</option>
            <option value="주의">🟡 주의</option>
            <option value="불량">🔴 불량</option>
            <option value="고사">💀 고사</option>
        </select>
    </div>

</div>

<!-- end  ---------------------------------------------------------------- 1105 - 01   -->






                </div>
            </div>
        </div>

        <div class="upload-area" id="uploadArea">
            <input type="file" id="fileInput" accept="image/jpeg,image/png" multiple>
            <div id="uploadPlaceholder">
                <div class="upload-icon">🏞️</div>
                <div class="upload-text">
                    현장 사진 (JPG, PNG)을 여기에 드래그하세요<br>
                    파일 크기 10MB 이하, 크기 300px 이상<br>
                    <strong>여러 장 선택 가능</strong>
                </div>
            </div>
        </div>

        <div class="image-counter" id="imageCounter">
            <span class="counter-text">📸 <span id="imageCount">0</span>장의 현장 사진</span>
            <button class="clear-all-btn" onclick="clearAllImages()">🗑️ 모두 삭제</button>
        </div>

        <div class="drag-hint" id="dragHint">
            💡 사진을 드래그하여 순서를 조정할 수 있습니다 (가로수 경로 순서)
        </div>

        <div class="image-gallery" id="imageGallery">
        </div>

        <div class="selected-image-display" id="selectedImageDisplay">
            <div class="selected-image-header">
                <span class="selected-image-title">선택된 현장 사진</span>
            </div>
            <img id="selectedImagePreview" class="selected-image-preview">
        </div>


        
        <div class="prompt-section">
            <div class="prompt-label">
                상세 메모
            </div>
            <textarea class="prompt-textarea" placeholder="예: 3번 구역 느티나무, 수목 상태 양호, 병충해 없음. (선택한 사진의 EXIF 정보가 여기에 자동으로 표시됩니다.)"></textarea>
        </div>
        
        <div class="location-section" id="locationSection">
            <div class="location-header">
                <span class="location-icon">📍</span>
                <span>촬영 위치 정보 (GPS)</span>
            </div>
            <div class="location-info" id="locationInfo">
                <div class="no-location">위치 정보가 없습니다.</div>
            </div>
            <div class="map-container" id="mapContainer" style="display: none;">
                <div id="locationMap"></div>
                <button class="map-close-btn" onclick="toggleMapFullscreen()">✕ 닫기</button>
            </div>
            <div class="location-actions" id="locationActions" style="display: none;">
                <button class="location-btn" id="kakaoDirectionsBtn" onclick="openKakaoDirections()" disabled>🌳 가로수 전체보기</button>
                <button class="location-btn" onclick="copyCoordinates()">📋 좌표 복사</button>
                <button class="location-btn" onclick="toggleMapFullscreen()">🖥️ 지도 전체화면</button>
            </div>
        </div>

<div id="googleDriveSection" class="google-drive-section">
    <!-- 헤더 -->
    <div class="drive-header">
        <div class="drive-title">
            <span class="drive-icon">📁</span>
            <span>Google Drive 관리</span>
        </div>
    </div>

    <!-- ✅ 로그인 전: 버튼 → 체크박스 순서 -->
    <div id="loginContainer" class="login-container">
        <!-- 1️⃣ 먼저: 구글 로그인 버튼 -->
        <button id="signInBtn" class="sign-in-btn" onclick="handleAuthClick()">
            <svg class="google-icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335"  d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            <span>Google 로그인</span>
        </button>

        <label class="keep-signed-in-container" for="keepSignedIn">
         <input type="checkbox" id="keepSignedIn" checked>
         <span>로그인 상태 유지</span>
       </label>
    </div>

    <!-- 로그인 후: 사용자 정보 -->
    <div id="userInfo" class="user-info">
        <div class="user-info-left">
            <div class="user-avatar">👤</div>
            <div class="user-details">
                <div class="user-greeting">로그인됨</div>
                <div id="userName" class="user-name"></div>
            </div>
            <div class="session-indicator">
                <span class="session-dot"></span>
                <span>활성</span>
            </div>
        </div>
        <button id="signOutBtn" class="sign-out-btn" onclick="handleSignoutClick()">
            로그아웃
        </button>
    </div>

    <!-- 드라이브 로드 섹션 -->
    <div id="driveLoadSection" class="drive-load-section">
        <div class="section-header">
            <h3>📋 기존 데이터 불러오기</h3>
        </div>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button class="drive-upload-btn" onclick="loadExistingData()" style="background-color: rgba(255,255,255,0.2); color: white;">
                <span>📁</span>
                <span>기존 폴더에서 불러오기</span>
            </button>
            <button class="drive-upload-btn" onclick="mergeSpreadsheets()" style="background-color: rgba(255,255,255,0.2); color: white;">
                <span>📊</span>
                <span>스프레드시트 통합하기</span>
            </button>
        </div>
    </div>

    <!-- 드라이브 액션 버튼 -->
    <div id="driveActions" class="drive-actions">
        <button class="drive-upload-btn" onclick="uploadToGoogleDrive('selected')" id="uploadSelectedBtn">
            <span>📤</span>
            <span>선택된 사진 업로드</span>
        </button>
        <button class="drive-upload-btn" onclick="uploadToGoogleDrive('all')" id="uploadAllBtn">
            <span>📤</span>
            <span>모든 사진 업로드</span>
        </button>
    </div>

    <!-- 업로드 진행 상황 -->
    <div id="uploadProgress" class="upload-progress"></div>
</div>

        <button class="generate-btn" onclick="generateVideo()">
            <span class="credit-icon">💾</span>
            <span>정보 저장하기</span>
        </button>
    </div>

    <!-- Custom Script -->
    <script src="script.js"></script>
    <script src="sidemenu_functions.js"></script>
</body>
</html>


